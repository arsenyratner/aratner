---
# tasks file for system

- name: Set hostname
  routeros_command:
    commands:
      - /system identity set name="{{ inventory_hostname }}"

- name: Update login banner
  routeros_command:
    commands: 
      - /system note set show-at-login=yes
      - >
        /system note set note="\
        \n      ----------------------------------------\
        \n      |\
        \n      | This banner was generated by Ansible\
        \n      |\
        \n      ----------------------------------------\
        \n      |\
        \n      | You are logged into {{ inventory_hostname }}\
        \n      |\
        \n      ----------------------------------------" 

- name: Configure syslog
  routeros_command:
    commands:
      - /system logging remove [find where action=netsvr]
      - /system logging action set [find where action=remote] remote="{{ log_host }}" 
      - /system logging action remove [find where name=netsvr]
      - /system logging action add name="netsvr" remote="{{ log_host }}" remote-port=514 syslog-facility=local7 syslog-severity=auto target=remote
      - /system logging add action=netsvr disabled=no prefix={{ inventory_hostname }} topics=system,info
      - /system logging add action=netsvr disabled=no prefix={{ inventory_hostname }} topics=warning
      - /system logging add action=netsvr disabled=no prefix={{ inventory_hostname }} topics=critical
      - /system logging add action=netsvr disabled=no prefix={{ inventory_hostname }} topics=error,!ospf,!route
  tags:
    - logging
